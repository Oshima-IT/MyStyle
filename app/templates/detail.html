{% extends "base.html" %}

{% block title %}{{ item.name }} - 詳細{% endblock %}

{% block content %}
<div class="detail-container">

    <!-- Left: Image (3:4 Ratio) -->
    <div class="detail-image-area">
        <img src="{{ item.image_url }}" alt="{{ item.name }}" class="detail-image">
    </div>

    <!-- Right: Info -->
    <div class="detail-info-area">
        <h1 class="detail-title">{{ item.name }}</h1>
        <p class="detail-price">¥{{ item.price }}</p>

        <div class="detail-meta">
            <span class="meta-label">Category</span>
            <span class="meta-value">{{ item.category }}</span>
        </div>

        {% if item.styles %}
        <div class="detail-meta">
            <span class="meta-label">Styles</span>
            <span class="meta-value" style="font-size: 12px; line-height: 1.6;">
                {% if item.styles is string %}
                {{ item.styles }}
                {% else %}
                {{ item.styles|join(', ') }}
                {% endif %}
            </span>
        </div>
        {% endif %}

        {% if item.shop_url %}
        <div style="display: flex; gap: 8px; margin-bottom: 24px;">
            <a href="{{ url_for('item_click', item_id=item.id) }}" target="_blank" class="btn-black-sharp" style="flex: 1;">
                販売ページへ
            </a>
            <button id="save-btn" class="btn-save {% if is_bookmarked %}active{% endif %}" style="width: 50px; border: 1px solid #000; display: flex; align-items: center; justify-content: center; background: #fff; cursor: pointer;">
                <span class="material-symbols-outlined icon-bookmark" style="font-variation-settings: 'FILL' {{ 1 if is_bookmarked else 0 }}, 'wght' 400, 'GRAD' 0, 'opsz' 24;">
                    bookmark
                </span>
            </button>
        </div>
        {% else %}
        <!-- No link available state -->
        <button class="btn-black-sharp" disabled style="background: #ccc; cursor: not-allowed; margin-bottom: 24px;">
            SOLD OUT
        </button>
        {% endif %}

        <script>
            document.getElementById('save-btn')?.addEventListener('click', async function () {
                const btn = this;
                const icon = btn.querySelector('.material-symbols-outlined');
                const res = await fetch("{{ url_for('item_save', item_id=item.id) }}", { method: 'POST' });
                const data = await res.json();

                if (data.status === 'ok') {
                    if (data.is_bookmarked) {
                        btn.classList.add('active');
                        icon.style.fontVariationSettings = "'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24";
                    } else {
                        btn.classList.remove('active');
                        icon.style.fontVariationSettings = "'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24";
                    }
                }
            });
        </script>

    </div>

</div>
{% endblock %}
